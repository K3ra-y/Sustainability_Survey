---
title: "Milestone 3"
author: "Heather VT., Kera Y., Marcelle C., Wilson D."
date: "April 13th, 2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path = "images_report/")
library(tidyverse)
library(gridExtra)
library(MASS)
```



## Introduction

The current analysis seeks to explore the relationship between `self-rated sustainability importance` and `recycling frequency`. Additionally, the analysis also aims to determine whether this relationship is confounded by an `age of the individual` and `background (environmentally-conscious family)`, and analyze if a video about recycling changes individuals€™ opinions on the importance of sustainability. With this purpose, we published a [survey](https://ubc.ca1.qualtrics.com/jfe/form/SV_4SJCJH59wUakrEF) using [UBC-hosted version of Qualtrics](https://ubc.ca1.qualtrics.com/) to collect responses to be used in this analysis.

## Methods

### Survey study design 

### Data collection methods

> Online survey with Qualtrics UBC


Data was collected from participents who agreed to give consent to share their data in which was used to address our survey objective. Participants rated themselves in terms of how sustainable they think they are (main predictor). We also collected data on frequency of recycling habits, age of the participants and whether or not the participant was brought up in environmentally consious family. Our assumption is that the main response is frequency of recycling, and age and background is confounding factors.

Additionally we gave an option for the participant to watch a short video and asked them to rate themselves based on change in self perseption towards sustainability.

### Analysis methods

Ordinal linear regression is performed to analyze relationship between `self-rated sustainability importance` and `recycling frequency`, as well as `age of the individual` and `background (environmentally-conscious family)`. 

Assumptions of the Ordinal Linear regression are; (1) one predictor in the model (`recycling frequency`), (2) Each category has its own regression model, (3) No category has 0 count. 

After fitting the additive model, we also explored multiplicative model to reveal the effects of confounding variables.


## Results

```{r load data, warning=FALSE}
# load data
tidy_data <- read.csv("../data/tidy_data.csv")

# factor relevel
tidy_data$recycling_freq <- tidy_data$recycling_freq %>% fct_relevel("Rarely","Sometimes","Usually","Always")
tidy_data$background <- tidy_data$background %>% fct_relevel("Yes","No")
tidy_data$watch <- tidy_data$watch %>% fct_relevel("Have watched","Will pass")
```


```{r summary table}
# Creating summary table
#summary(tidy_data)
```


```{r ANOVA to find confounders}
#simple_model = lm(data=tidy_data, recycling_freq ~ self_rating_before)
#age_confounder = lm(data=tidy_data, recycling_freq ~ self_rating_before + age)
#background_confounder = lm(data=tidy_data, recycling_freq ~ self_rating_before + background)
#interaction_effects = lm(data=tidy_data, recycling_freq ~ self_rating_before + background*age)

#summary(simple_model)
```

We compiled the self-rated sustainability importance, recycling frequency, age and background information from 68 survey entries. Thus, to have a general idea of the relationship between self-rated sustainability importance and recycling frequency, we can analyze the following boxplots.

```{r visualization}
# Visualization of relationship between recycling freq. and self rating before watching the video
tidy_data %>%
  ggplot(aes(x = recycling_freq, y = self_rating_before)) +
  geom_boxplot(size = .75) +
  geom_jitter(alpha = .1, height = .2) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1)) +
  coord_flip() +
  theme_bw() +
  labs(y = "Rating before watching the video", x = "Recycling Frequency") +
  ggtitle("Sustainability Importance vs. Recycling Freq.") +
  theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
        axis.text = element_text(size = 12),
        axis.title = element_text(size = 13))
```

Analyzing the boxplots above is easy to notice that people who recycle more often consider sustainability more important (having a higher self rating mean, and narrower range) than the ones who rarely recycle, which suggests that a person's opinion about sustainability importance influences the recycling frequency. 

Thus, fitting an ordinal regression model considering self-rated sustainability importance before watching the video, individuals' age and background as predictors:

```{r olr model}
# Fit a OLR model without interaction
olr_model <- polr(recycling_freq ~ self_rating_before + background + age, data = tidy_data)

tidy_data <- tidy_data %>%
  cbind(., olr_model_prob = predict(olr_model, ., type = "probs")) %>% #estimated probability
  cbind(., olr_model_decision = predict(olr_model))                   #estimated result according to the probabilities
```

Analyzing the goodness of fit, looking for AIC and likelihood, we obtained:

```{r}
gf <- table(tidy_data$recycling_freq, tidy_data$olr_model_decision)
accuracy <- (gf[1] + gf[6] + gf[11] + gf[16]) / 68 # 68 observations

print(paste("AIC = ", AIC(olr_model))) 
print(paste("Log likelihood = ", logLik(olr_model))) 
print(paste("Overall accuracy = ", accuracy)) # The larger the better
```

The values look nice, so now we can get the coefficients:

```{r}
# Get the coefficients
coef(summary(olr_model))
```

Interpreting the coefficients:

- Example of slope interpretation: For `self_rating_before`, one unit increase in `self_rating_before`, there is a ~0.67 increase in the expected value of recycling frequency (in log odds scale), given that all of the other variables in the model are constant. A positive slope indicates a tendency for the response level to increase as the predictor increases.

- Example of intercept interpretation: ~5.49 is the expected log odds of recycle "usually" versus "always" when all the predictors are 0.


Multiplicative effect of the counfounders are explored below:

```{r olr multiplicative model}
# Fit a OLR model with interaction
olr_model_interaction <- polr(recycling_freq ~ self_rating_before + background * age, data = tidy_data)

tidy_data <- tidy_data %>%
  cbind(., olr_model_prob2 = predict(olr_model_interaction, ., 
                                    type = "probs")) %>% #estimated probability
  cbind(., olr_model_decision2 = predict(olr_model_interaction))                   #estimated result according to the probabilities
```

```{r}
gf2 <- table(tidy_data$recycling_freq, tidy_data$olr_model_decision2)
accuracy <- (gf2[1] + gf2[6] + gf2[11] + gf2[16]) / 68 # 68 observations

print(paste("AIC for OLR model with interaction = ", AIC(olr_model_interaction))) 
print(paste("Log likelihood of OLR model with interaction = ", logLik(olr_model_interaction))) 
print(paste("Overall accuracy of OLR model with interaction = ", accuracy)) # The larger the better
```


## Discussion 

### Discussion of results

### Discussion of survey/study design



### NOTES for reference
 >3-5 page report

    > Your target audience is other Data Scientists who are not familiar with your project.
    Clearly introduce the survey topic and question you were interested in answering.
    Link to your study's data and code in the methods section of your report.
    Include effective visualizations and/or tables that help communicate your findings.
    Your discussion should have 2 key focuses:
        Discussing the results and findings of your survey and analysis of the survey data.
        Discussing your survey/study design, specifically:
        what did you do well to make this study as causal as possible?
        what was not done well and how did that effect your studies conclusions?
        what would you do differently next time to improve your survey/study design and why?
